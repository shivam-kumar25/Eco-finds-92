{% extends "base.html" %}

{% block title %}Complaint Management{% endblock %}

{% block content %}
<div class="admin-complaints">
  <div class="complaints-header">
    <h1>Complaint Management</h1>
    <p class="subtitle">Review and resolve user complaints</p>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="filter-bar">
    <form action="{{ url_for('admin.complaints') }}" method="GET" class="filter-form">
      <div class="filter-group">
        <label for="status">Filter by Status:</label>
        <select name="status" id="status" onchange="this.form.submit()">
          <option value="">All Statuses</option>
          <option value="open" {% if request.args.get('status') == 'open' %}selected{% endif %}>Open</option>
          <option value="in progress" {% if request.args.get('status') == 'in progress' %}selected{% endif %}>In Progress</option>
          <option value="resolved" {% if request.args.get('status') == 'resolved' %}selected{% endif %}>Resolved</option>
          <option value="closed" {% if request.args.get('status') == 'closed' %}selected{% endif %}>Closed</option>
        </select>
      </div>
      <div class="filter-group">
        <input type="text" name="search" placeholder="Search complaints..." value="{{ request.args.get('search', '') }}">
        <button type="submit" class="btn search-btn">Search</button>
      </div>
    </form>
  </div>

  <table class="complaint-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>User</th>
        <th>Subject</th>
        <th>Item</th>
        <th>Status</th>
        <th>Date Reported</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for complaint in complaints %}
      <tr>
        <td>{{ complaint.id }}</td>
        <td>{{ complaint.user_name }}</td>
        <td>{{ complaint.subject }}</td>
        <td>{{ complaint.item_name }} (#{{ complaint.item_id }})</td>
        <td>
          <span class="status-badge status-{{ complaint.status|lower|replace(' ', '-') }}">
            {{ complaint.status }}
          </span>
        </td>
        <td>{{ complaint.date_reported.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
          <a href="{{ url_for('admin.complaint_detail', complaint_id=complaint.id) }}" class="btn view-btn">View Details</a>
        </td>
      </tr>
      {% endfor %}
      {% if not complaints %}
      <tr>
        <td colspan="7" class="no-results">No complaints found.</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <div class="pagination">
    <a href="#" class="page-link">Previous</a>
    <span class="page-number active">1</span>
    <a href="#" class="page-link">2</a>
    <a href="#" class="page-link">3</a>
    <a href="#" class="page-link">Next</a>
  </div>
</div>

<style>
  .admin-complaints {
    padding: 2rem;
  }
  .complaints-header {
    margin-bottom: 2rem;
  }
  .filter-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background-color: #f8f9fa;
    border-radius: 8px;
  }
  .filter-form {
    display: flex;
    width: 100%;
    justify-content: space-between;
  }
  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .complaint-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
  }
  .complaint-table th, .complaint-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #dee2e6;
  }
  .complaint-table th {
    background-color: #f8f9fa;
    text-align: left;
  }
  .status-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
  }
  .status-open {
    background-color: #ffc107;
    color: #212529;
  }
  .status-in-progress {
    background-color: #17a2b8;
    color: white;
  }
  .status-resolved {
    background-color: #28a745;
    color: white;
  }
  .status-closed {
    background-color: #6c757d;
    color: white;
  }
  .view-btn {
    padding: 0.25rem 0.5rem;
    background-color: #007bff;
    color: white;
    border-radius: 4px;
    text-decoration: none;
    font-size: 0.875rem;
  }
  .pagination {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
  }
  .page-link, .page-number {
    padding: 0.5rem 0.75rem;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    text-decoration: none;
    color: #007bff;
  }
  .page-number.active {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
  }
  .no-results {
    text-align: center;
    padding: 2rem;
    font-style: italic;
    color: #6c757d;
  }
</style>
{% endblock %}
